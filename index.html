<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HR Portal</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <!-- 
      FIX 1: Removed the lucide.js script tag. 
      The inline SVGs for the eye icon are already in the HTML.
    -->
</head>
<body class="bg-gray-100">

    <!-- Login Container -->
    <div id="login-container" class="min-h-screen flex items-center justify-center">
        <div class="bg-white p-8 rounded-lg shadow-xl w-full max-w-sm">
            <h2 class="text-2xl font-bold text-center text-gray-800 mb-6">HR Portal Login</h2>
            <form id="login-form">
                <div class="mb-4">
                    <label for="email" class="block text-sm font-medium text-gray-700">Email</label>
                    <input type="email" id="login-email" class="w-full p-3 mt-1 border border-gray-300 rounded-lg" required>
                </div>
                <!-- UPDATED: Password Input with Toggle -->
                <div class="mb-6">
                    <label for="password" class="block text-sm font-medium text-gray-700">Password</label>
                    <div class="relative">
                        <input type="password" id="login-password" class="w-full p-3 mt-1 border border-gray-300 rounded-lg pr-10" required>
                        <button type="button" id="password-toggle-btn" class="absolute inset-y-0 right-0 top-1 flex items-center px-3 text-gray-500 hover:text-gray-700">
                            <!-- Lucide Icons (inlined) -->
                            <svg id="eye-icon" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-eye"><path d="M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z"/><circle cx="12" cy="12" r="3"/></svg>
                            <svg id="eye-off-icon" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-eye-off hidden"><path d="M9.88 9.88a3 3 0 1 0 4.24 4.24"/><path d="M10.73 5.08A10.43 10.43 0 0 1 12 5c7 0 10 7 10 7a13.16 13.16 0 0 1-1.67 2.68"/><path d="M6.61 6.61A13.526 13.526 0 0 0 2 12s3 7 10 7a9.74 9.74 0 0 0 5.39-1.61"/><line x1="2" x2="22" y1="2" y2="22"/></svg>
                        </button>
                    </div>
                </div>
                <!-- END UPDATED -->
                <p id="login-error" class="text-sm text-red-600 mb-4 hidden"></p>
                <button type="submit" id="login-btn" class="w-full py-3 bg-blue-600 text-white font-semibold rounded-lg hover:bg-blue-700">
                    Login
                </button>
            </form>
        </div>
    </div>

    <!-- 
      Super Admin Dashboard
    -->
    <div id="super-admin-container" class="container mx-auto p-8 hidden">
        <header class="flex justify-between items-center mb-6">
            <h1 class="text-3xl font-bold text-gray-800">
                Super Admin Dashboard
            </h1>
            <button id="logout-button-super" class="px-4 py-2 bg-red-600 text-white font-semibold rounded-lg hover:bg-red-700">
                Logout
            </button>
        </header>

        <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
            <!-- Left Column: Create Company -->
            <div class="md:col-span-1 bg-white rounded-xl shadow-2xl p-6 h-fit">
                <h2 class="text-xl font-semibold text-gray-700 mb-4">Create New Company</h2>
                <form id="create-company-form" class="space-y-4">
                    
                    <div>
                        <label for="company-name" class="block text-sm font-medium text-gray-700">Company Name</label>
                        <input type="text" id="company-name" class="w-full p-3 mt-1 border border-gray-300 rounded-lg" required>
                    </div>
                    
                    <div>
                        <label for="company-slug" class="block text-sm font-medium text-gray-700">Unique URL Slug (e.g., "globalmax")</label>
                        <input type="text" id="company-slug" class="w-full p-3 mt-1 border border-gray-300 rounded-lg" required>
                    </div>

                    <div>
                        <label for="company-phone" class="block text-sm font-medium text-gray-700">Contact Phone</label>
                        <input type="tel" id="company-phone" class="w-full p-3 mt-1 border border-gray-300 rounded-lg">
                    </div>

                    <div>
                        <label for="company-email" class="block text-sm font-medium text-gray-700">Contact Email</label>
                        <input type="email" id="company-email" class="w-full p-3 mt-1 border border-gray-300 rounded-lg">
                    </div>

                    <div>
                        <label for="company-street" class="block text-sm font-medium text-gray-700">Street</label>
                        <input type="text" id="company-street" class="w-full p-3 mt-1 border border-gray-300 rounded-lg">
                    </div>

                    <div>
                        <label for="company-city" class="block text-sm font-medium text-gray-700">City</label>
                        <input type="text" id="company-city" class="w-full p-3 mt-1 border border-gray-300 rounded-lg">
                    </div>

                    <div>
                        <label for="company-state" class="block text-sm font-medium text-gray-700">State (e.g., "IL")</label>
                        <input type="text" id="company-state" class="w-full p-3 mt-1 border border-gray-300 rounded-lg" maxlength="2">
                    </div>

                    <div>
                        <label for="company-zip" class="block text-sm font-medium text-gray-700">ZIP Code</label>
                        <input type="text" id="company-zip" class="w-full p-3 mt-1 border border-gray-300 rounded-lg">
                    </div>

                    <div>
                        <label for="company-mc" class="block text-sm font-medium text-gray-700">MC Number</label>
                        <input type="text" id="company-mc" class="w-full p-3 mt-1 border border-gray-300 rounded-lg">
                    </div>

                    <div>
                        <label for="company-dot" class="block text-sm font-medium text-gray-700">DOT Number</label>
                        <input type="text" id="company-dot" class="w-full p-3 mt-1 border border-gray-300 rounded-lg">
                    </div>

                    <p id="create-company-success" class="text-sm text-green-600 hidden"></p>
                    <p id="create-company-error" class="text-sm text-red-600 hidden"></p>
                    
                    <button type="submit" id="create-company-btn" class="w-full py-3 bg-green-600 text-white font-semibold rounded-lg hover:bg-green-700">
                        Create Company
                    </button>
                </form>
            </div>

            <!-- Right Column: Manage Companies & Admins -->
            <div class="md:col-span-2 space-y-8">
                <div class="bg-white rounded-xl shadow-2xl p-6">
                    <h2 class="text-xl font-semibold text-gray-700 mb-4">Manage Companies</h2>
                    <div id="company-list" class="space-y-4">
                        <p>Loading companies...</p>
                    </div>
                </div>
                
                <div class="bg-white rounded-xl shadow-2xl p-6">
                    <h2 class="text-xl font-semibold text-gray-700 mb-4">Create New Company User</h2>
                    <form id="create-admin-form" class="space-y-4">
                        
                        <div>
                            <label for="admin-full-name" class="block text-sm font-medium text-gray-700">Full Name</label>
                            <input type="text" id="admin-full-name" class="w-full p-3 mt-1 border border-gray-300 rounded-lg" required>
                        </div>

                        <div>
                            <label for="admin-email" class="block text-sm font-medium text-gray-700">Email Address</label>
                            <input type="email" id="admin-email" class="w-full p-3 mt-1 border border-gray-300 rounded-lg" required>
                        </div>

                        <div>
                            <label for="admin-password" class="block text-sm font-medium text-gray-700">Temporary Password</label>
                            <input type="password" id="admin-password" class="w-full p-3 mt-1 border border-gray-300 rounded-lg" required>
                        </div>

                        <div>
                            <label for="admin-company-select" class="block text-sm font-medium text-gray-700">Assign to Company</label>
                            <select id="admin-company-select" class="w-full p-3 mt-1 border border-gray-300 rounded-lg" required>
                                <option value="">Loading companies...</option>
                            </select>
                        </div>

                        <div>
                            <label for="admin-role-select" class="block text-sm font-medium text-gray-700">Select Role</label>
                            <select id="admin-role-select" class="w-full p-3 mt-1 border border-gray-300 rounded-lg" required>
                                <option value="company_admin">Company Admin (Can manage users and applications)</option>
                                <option value="hr_user">HR User (Can only view applications)</option>
                            </select>
                        </div>

                        <p id="create-admin-success" class="text-sm text-green-600 hidden"></p>
                        <p id="create-admin-error" class="text-sm text-red-600 hidden"></p>
                        
                        <button type="submit" id="create-admin-btn" class="w-full py-3 bg-blue-600 text-white font-semibold rounded-lg hover:bg-blue-700">
                            Create User
                        </button>
                    </form>
                </div>

                <!-- 
                  "Manage Users" Card
                -->
                <div id="manage-users-card" class="bg-white rounded-xl shadow-2xl p-6">
                    <h2 class="text-xl font-semibold text-gray-700 mb-4">Manage All Users</h2>
                    <div id="user-list" class="space-y-4">
                        <p>Loading users...</p>
                    </div>
                </div>
                <!-- End of New Section -->

            </div>
        </div>
    </div>

    <!-- Company Admin Dashboard -->
    <div id="company-admin-container" class="container mx-auto p-8 hidden">
        <header class="flex justify-between items-center mb-6">
            <h1 class="text-3xl font-bold text-gray-800">
                <span id="company-admin-header">Company Dashboard</span>
            </h1>
            <div>
                <button id="switch-company-button" class="px-4 py-2 bg-gray-500 text-white font-semibold rounded-lg hover:bg-gray-600 mr-4">
                    Switch Company
                </button>
                <button id="logout-button-company" class="px-4 py-2 bg-red-600 text-white font-semibold rounded-lg hover:bg-red-700">
                    Logout
                </button>
            </div>
        </header>

        <div class="bg-white rounded-xl shadow-2xl overflow-hidden">
            <div class="p-6">
                <h2 class="text-xl font-semibold text-gray-700 mb-4">Submitted Applications</h2>
                <div id="application-list" class="space-y-4">
                    <p>Loading applications...</p>
                </div>
            </div>
        </div>
    </div>

    <!-- "Choose Company" Modal -->
    <div id="choose-company-modal" class="fixed inset-0 bg-gray-900 bg-opacity-75 flex items-center justify-center p-4 z-50 hidden">
        <div class="bg-white rounded-lg shadow-xl w-full max-w-md">
            <div class="p-6">
                <h2 class="text-2xl font-bold text-gray-800 mb-2">Choose company</h2>
                <p class="text-gray-600 mb-6">You have access to multiple companies, please pick one you would like to log in.</p>
                <div id="company-choice-list" class="space-y-3">
                    <p>Loading companies...</p>
                </div>
                <button id="logout-button-modal" class="w-full text-center mt-6 px-4 py-2 bg-gray-200 text-gray-700 font-semibold rounded-lg hover:bg-gray-300">
                    Logout
                </button>
            </div>
        </div>
    </div>

    <!-- 
      "Edit Company" Modal 
    -->
    <div id="edit-company-modal" class="fixed inset-0 bg-gray-900 bg-opacity-75 flex items-center justify-center p-4 z-50 hidden">
        <div class="bg-white rounded-lg shadow-xl w-full max-w-2xl max-h-[90vh] flex flex-col">
            <h2 class="text-2xl font-bold text-gray-800 p-6 border-b">Edit Company</h2>
            
            <form id="edit-company-form" class="p-6 overflow-y-auto space-y-4">
                <!-- Hidden input to store company ID -->
                <input type="hidden" id="edit-company-id">
                
                <div>
                    <label for="edit-company-name" class="block text-sm font-medium text-gray-700">Company Name</label>
                    <input type="text" id="edit-company-name" class="w-full p-3 mt-1 border border-gray-300 rounded-lg" required>
                </div>
                
                <div>
                    <label for="edit-company-slug" class="block text-sm font-medium text-gray-700">Unique URL Slug</label>
                    <input type="text" id="edit-company-slug" class="w-full p-3 mt-1 border border-gray-300 rounded-lg" required>
                </div>

                <div>
                    <label for="edit-company-phone" class="block text-sm font-medium text-gray-700">Contact Phone</label>
                    <input type="tel" id="edit-company-phone" class="w-full p-3 mt-1 border border-gray-300 rounded-lg">
                </div>

                <div>
                    <label for="edit-company-email" class="block text-sm font-medium text-gray-700">Contact Email</label>
                    <input type="email" id="edit-company-email" class="w-full p-3 mt-1 border border-gray-300 rounded-lg">
                </div>

                <div>
                    <label for="edit-company-street" class="block text-sm font-medium text-gray-700">Street</label>
                    <input type="text" id="edit-company-street" class="w-full p-3 mt-1 border border-gray-300 rounded-lg">
                </div>

                <div>
                    <label for="edit-company-city" class="block text-sm font-medium text-gray-700">City</label>
                    <input type="text" id="edit-company-city" class="w-full p-3 mt-1 border border-gray-300 rounded-lg">
                </div>

                <div>
                    <label for="edit-company-state" class="block text-sm font-medium text-gray-700">State (e.g., "IL")</label>
                    <input type="text" id="edit-company-state" class="w-full p-3 mt-1 border border-gray-300 rounded-lg" maxlength="2">
                </div>

                <div>
                    <label for="edit-company-zip" class="block text-sm font-medium text-gray-700">ZIP Code</label>
                    <input type="text" id="edit-company-zip" class="w-full p-3 mt-1 border border-gray-300 rounded-lg">
                </div>

                <div>
                    <label for="edit-company-mc" class="block text-sm font-medium text-gray-700">MC Number</label>
                    <input type="text" id="edit-company-mc" class="w-full p-3 mt-1 border border-gray-300 rounded-lg">
                </div>

                <div>
                    <label for="edit-company-dot" class="block text-sm font-medium text-gray-700">DOT Number</label>
                    <input type="text" id="edit-company-dot" class="w-full p-3 mt-1 border border-gray-300 rounded-lg">
                </div>
            </form>
            
            <div class="p-4 bg-gray-50 border-t flex justify-between items-center">
                <p id="edit-company-message" class="text-sm"></p>
                <div class="flex gap-3">
                    <button id="edit-company-cancel-btn" class="px-4 py-2 bg-gray-200 text-gray-700 font-semibold rounded-lg hover:bg-gray-300">
                        Cancel
                    </button>
                    <button id="edit-company-save-btn" class="px-4 py-2 bg-blue-600 text-white font-semibold rounded-lg hover:bg-blue-700">
                        Save Changes
                    </button>
                </div>
            </div>
        </div>
    </div>
    <!-- End "Edit Company" Modal -->

    <!-- 
      "Delete Company" Confirmation Modal 
    -->
    <div id="delete-company-modal" class="fixed inset-0 bg-gray-900 bg-opacity-75 flex items-center justify-center p-4 z-50 hidden">
        <div class="bg-white rounded-lg shadow-xl w-full max-w-lg">
            <div class="p-6">
                <h2 class="text-2xl font-bold text-red-700 mb-4">Delete Company?</h2>
                <p class="text-gray-600 mb-2">
                    Are you sure you want to delete <strong id="delete-company-name" class="font-bold"></strong>?
                </pre>
                <p class="text-sm text-gray-600 mb-6">
                    This is a destructive action. It will permanently delete the company, all its users, all applications, and all associated files. This cannot be undone.
                </p>
                <p id="delete-company-error" class="text-sm text-red-600 mb-4 hidden"></p>
                <div class="flex justify-end gap-4">
                    <button id="delete-company-cancel-btn" class="px-5 py-2 bg-gray-200 text-gray-700 font-semibold rounded-lg hover:bg-gray-300">
                        Cancel
                    </button>
                    <button id="delete-company-confirm-btn" class="px-5 py-2 bg-red-600 text-white font-semibold rounded-lg hover:bg-red-700">
                        Delete Company
                    </button>
                </div>
            </div>
        </div>
    </div>
    <!-- End "Delete Company" Modal -->


    <!-- 
      "Edit User" Modal 
    -->
    <div id="edit-user-modal" class="fixed inset-0 bg-gray-900 bg-opacity-75 flex items-center justify-center p-4 z-50 hidden">
        <div class="bg-white rounded-lg shadow-xl w-full max-w-2xl max-h-[90vh] flex flex-col">
            <h2 class="text-2xl font-bold text-gray-800 p-6 border-b">Edit User</h2>
            
            <div class="p-6 overflow-y-auto space-y-6">
                <!-- Hidden input to store user ID -->
                <input type="hidden" id="edit-user-id">
                
                <!-- Basic Info Form -->
                <form id="edit-user-form" class="space-y-4">
                    <div>
                        <label for="edit-user-name" class="block text-sm font-medium text-gray-700">Full Name</label>
                        <input type="text" id="edit-user-name" class="w-full p-3 mt-1 border border-gray-300 rounded-lg" required>
                    </div>
                    <div>
                        <label for="edit-user-email" class="block text-sm font-medium text-gray-700">Email (Read-only)</label>
                        <input type="email" id="edit-user-email" class="w-full p-3 mt-1 border border-gray-300 rounded-lg bg-gray-100" readonly>
                    </div>
                     <button id="edit-user-save-btn" type="button" class="px-5 py-2 bg-blue-600 text-white font-semibold rounded-lg hover:bg-blue-700">
                        Save Name Change
                    </button>
                    <p id="edit-user-message" class="text-sm inline-block ml-4"></p>
                </form>

                <!-- Memberships Management -->
                <div class="pt-6 border-t">
                    <h3 class="text-lg font-semibold text-gray-700 mb-3">Company Memberships</h3>
                    <div id="edit-user-memberships-list" class="space-y-3 mb-4">
                        <!-- Membership items will be injected here -->
                        <p>Loading memberships...</p>
                    </div>
                    
                    <!-- Add New Membership Form -->
                    <form id="add-membership-form" class="flex items-end gap-3 p-3 bg-gray-50 rounded-lg border">
                        <div class="flex-1">
                            <label for="add-membership-company" class="block text-sm font-medium text-gray-700">Add to Company</label>
                            <select id="add-membership-company" class="w-full p-3 mt-1 border border-gray-300 rounded-lg" required>
                                <option value="">Select a company</option>
                            </select>
                        </div>
                        <div class="flex-1">
                            <label for="add-membership-role" class="block text-sm font-medium text-gray-700">As Role</label>
                            <select id="add-membership-role" class="w-full p-3 mt-1 border border-gray-300 rounded-lg" required>
                                <option value="hr_user">HR User</option>
                                <option value="company_admin">Company Admin</option>
                            </select>
                        </div>
                        <button type="submit" class="px-4 py-3 bg-green-600 text-white font-semibold rounded-lg hover:bg-green-700">Add</button>
                    </form>
                    <p id="add-membership-error" class="text-sm text-red-600 mt-2 hidden"></p>
                </div>
            </div>
            
            <div class="p-4 bg-gray-50 border-t flex justify-end items-center">
                <button id="edit-user-close-btn" class="px-5 py-2 bg-gray-200 text-gray-700 font-semibold rounded-lg hover:bg-gray-300">
                    Close
                </button>
            </div>
        </div>
    </div>
    <!-- End "Edit User" Modal -->

    <!-- 
      "Delete User" Confirmation Modal 
    -->
    <div id="delete-user-modal" class="fixed inset-0 bg-gray-900 bg-opacity-75 flex items-center justify-center p-4 z-50 hidden">
        <div class="bg-white rounded-lg shadow-xl w-full max-w-lg">
            <div class="p-6">
                <h2 class="text-2xl font-bold text-red-700 mb-4">Delete User?</h2>
                <p class="text-gray-600 mb-2">
                    Are you sure you want to delete <strong id="delete-user-name" class="font-bold"></strong>?
                </p>
                <p class="text-sm text-gray-600 mb-6">
                    This is a destructive action. It will permanently delete the user's login, their user profile, and all their company memberships. This cannot be undone.
                </p>
                <p id="delete-user-error" class="text-sm text-red-600 mb-4 hidden"></p>
                <div class="flex justify-end gap-4">
                    <button id="delete-user-cancel-btn" class="px-5 py-2 bg-gray-200 text-gray-700 font-semibold rounded-lg hover:bg-gray-300">
                        Cancel
                    </button>
                    <button id="delete-user-confirm-btn" class="px-5 py-2 bg-red-600 text-white font-semibold rounded-lg hover:bg-red-700">
                        Delete User
                    </button>
                </div>
            </div>
        </div>
    </div>
    <!-- End "Delete User" Modal -->


    <!-- Agreement Text Templates -->
    <div id="agreement-templates" class="hidden">
        <template id="agreement-release">
            [COMPANY_NAME] is released from all liability in responding to inquiries and releasing information in connection with my application.
        </template>
        
        <template id="agreement-certify">
            My signature below certifies that this application was completed by me, and that all entries on it and information in it is true and complete to the best of my knowledge.
        </template>
        
        <template id="agreement-auth-psp">
            I authorize [COMPANY_NAME] ("Prospective Employer") to access the FMCSA Pre-Employment Screening Program (PSP) system to seek information regarding my commercial driving safety record and information regarding my safety inspection history. I understand that I am authorizing the release of safety performance information including crash data from the previous five (5) years and inspection history from the previous three (3) years. I understand and acknowledge that this release of information may assist the Prospective Employer to make a determination regarding my suitability as an employee.
        </template>
        
        <template id="agreement-clearinghouse">
            I hereby provide consent to [COMPANY_NAME] to conduct a limited query of the FMCSA Commercial Driver's License Drug and Alcohol Clearinghouse (Clearinghouse) to determine whether drug or alcohol violation information about me exists in the Clearinghouse. This limited query may be conducted by [COMPANY_NAME] on a periodic basis throughout my employment and no less than at least once a year.
        </template>
    </div>

    <!-- 
      Main JavaScript file
      We add "?v=9" to bust the cache.
    -->
    <script type="module" src="/src/main.js?v=9"></script>

</body>
</html>

